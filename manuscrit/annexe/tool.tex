
%\begin{savequote}[6cm]
%<< truc
%\qauthor{Test}
%\end{savequote}

\chapter{Scenarios YAML}\label{chap:annexe:tool}
\mtcaddchapter
\chaptertoc

\section{Saturation du lien local}\label{chap:annexe:tool:bp}
%,multicols=2,xleftmargin=3em
\begin{lstlisting}[language=yaml,caption=Scénario de saturation du lien groupe entre le nœud 0 et le nœud 1 avec 8 copies simultanées,label=lst:annexe:tool:bp]
---
scenarii:
  params: {}
  data:
    n_elems:
      type: int
      value: 25000000
    a<i>:
      i: [0, 7, 1]
      type: double*
      value: 0
    b<i>:
      i: [0, 7, 1]
      type: double*
      value: 0
  actions:
  # Initialisation des tableaux a<i> (source), sur le nœud 1
  - for:
    var: i
    limits: [0, 7, 1]
    actions:
    - kernel: init_array
      core: 8
      params:
      - a<i>
      - n_elems
  # Initialisation des tableaux b<i> (destination), sur le nœud 0
  - for:
    var: i
    limits: [0, 7, 1]
    actions:
    - kernel: init_array
      core: i
      params:
      - b<i>
      - n_elems
  - kernel: barrier
  # Exécution des copies simultanées sur les cœurs : 0, puis 0 et 1,
  # puis 0, 1, 2, etc.
  - for:
    var: i
    limits: [0, 7, 1]
    actions:
    - for:
      var: j
      # Génération des copies
      # simultanées.
      limits: [0, i, 1]
      actions:
      - kernel: copy
        core: 1
        repeat: 10
        params:
        - a<j>
        - b<j>
        - n_elems
    - kernel: barrier
  watchers:
    - name: time
      kernels: copy
\end{lstlisting}

\section{Scénario de base d'un \gemm sur un cœur}\label{chap:annexe:tool:dgemm-base}

\begin{lstlisting}[language=yaml,caption=Scénario de calcul d'un gemm,label=lst:annexe:tool:dgemm-base,multicols=2,xleftmargin=3em]
---
scenarii:
  data:
    bs:
      type: int
      value: 256
    a0:
      type: double*
      value: 0
    b0:
      type: double*
      value: 0
    c0:
      type: double*
      value: 0
  actions:
  - kernel: init_blas_bloc
    core: 0
    repeat: 1
    sync: false
    params:
    - a0
    - bs
  - kernel: init_blas_bloc
    core: 0
    repeat: 1
    sync: false
    params:
    - b0
    - bs
  - kernel: init_blas_bloc
    core: 0
    repeat: 1
    sync: false
    params:
    - c0
    - bs
  - kernel: dgemm
    core: 0
    repeat: '50'
    sync: true
    params:
    - a0
    - b0
    - c0
    - bs
  name: dgemm_256_local_1
  watchers:
    flops_dgemm:
    - bs
    time:
    - time
    papi:
    - PAPI_L3_TCM
    - PAPI_L3_DCR
    - PAPI_L3_DCW
\end{lstlisting}

\section{Sénario d'exécution de 3 \gemm indépendants}\label{chap:annexe:tool:dgemm}

\begin{lstlisting}[language=yaml,caption=Scénario de calcul de 3 gemm indépendants,label=lst:annexe:tool:dgemm,multicols=2,xleftmargin=3em]
---
scenarii:
  data:
    bs:
      type: int
      value: 256
    a0:
      type: double*
      value: 0
    b0:
      type: double*
      value: 0
    c0:
      type: double*
      value: 0
    a1:
      type: double*
      value: 0
    b1:
      type: double*
      value: 0
    c1:
      type: double*
      value: 0
    a2:
      type: double*
      value: 0
    b2:
      type: double*
      value: 0
    c2:
      type: double*
      value: 0
  actions:
  - kernel: init_blas_bloc
    core: 0
    repeat: 1
    sync: false
    params:
    - a0
    - bs
  - kernel: init_blas_bloc
    core: 0
    repeat: 1
    sync: false
    params:
    - b0
    - bs
  - kernel: init_blas_bloc
    core: 0
    repeat: 1
    sync: false
    params:
    - c0
    - bs
  - kernel: init_blas_bloc
    core: 1
    repeat: 1
    sync: false
    params:
    - a1
    - bs
  - kernel: init_blas_bloc
    core: 1
    repeat: 1
    sync: false
    params:
    - b1
    - bs
  - kernel: init_blas_bloc
    core: 1
    repeat: 1
    sync: false
    params:
    - c1
    - bs
  - kernel: init_blas_bloc
    core: 2
    repeat: 1
    sync: false
    params:
    - a2
    - bs
  - kernel: init_blas_bloc
    core: 2
    repeat: 1
    sync: false
    params:
    - b2
    - bs
  - kernel: init_blas_bloc
    core: 2
    repeat: 1
    sync: false
    params:
    - c2
    - bs
  - kernel: dgemm
    core: 0
    repeat: '50'
    sync: true
    params:
    - a0
    - b0
    - c0
    - bs
  - kernel: dgemm
    core: 1
    repeat: '50'
    sync: true
    params:
    - a1
    - b1
    - c1
    - bs
  - kernel: dgemm
    core: 2
    repeat: '50'
    sync: true
    params:
    - a2
    - b2
    - c2
    - bs
  name: dgemm_256_local_3
  watchers:
    flops_dgemm:
    - bs
    time:
    - time
    papi:
    - PAPI_L3_TCM
    - PAPI_L3_DCR
    - PAPI_L3_DCW
\end{lstlisting}
